DF_loop$ResidNorm   <- if( shapiro.test(resid(AOVmod))[[2]] > 0.05) {
'YES'} else {'NO'}
DF_loop$Levenes     <- leveneTest(AOVmod)[[3]][[1]]
DF_loop$HomogVar    <- if( leveneTest(AOVmod)[[3]][[1]] > 0.05) {
'YES'} else {'NO'}
if(shapiro.test(resid(AOVmod))[[2]] > 0.05 & leveneTest(AOVmod)[[3]][[1]] > 0.05) {
DF_loop$model       <- 'one-way AOV; x ~ treatment'
DF_loop$DF.num      <- summary(AOVmod)[[1]][["Df"]][1]
DF_loop$DF.denom    <- summary(AOVmod)[[1]][["Df"]][2]
DF_loop$F_val       <- summary(AOVmod)[[1]][["F value"]][1]
DF_loop$P_val       <- summary(AOVmod)[[1]][["Pr(>F)"]][1]
DF_loop$SigDif      <- if( (summary(AOVmod)[[1]][["Pr(>F)"]][1]) > 0.05) {
'NO'} else {'YES'}
} else {
DF_loop$model       <- 'kruskal-wallis; x ~ treatment'
DF_loop$DF.num      <- (KWmod)[[2]][["df"]][1]
DF_loop$DF.denom    <- NA
DF_loop$F_val       <- NA
DF_loop$P_val       <- (KWmod)[[3]]
DF_loop$SigDif      <- if( ((KWmod)[[3]]) > 0.05) {
'NO'} else {'YES'}
}
# asign loop and cumulative output table
df          <- data.frame(DF_loop) # name dataframe for this single row
AOVdf_total <- rbind(AOVdf_total,DF_loop) #bind to a cumulative list dataframe
print(AOVdf_total) # print to monitor progress
}
# View(AOVdf_total) # view all the anova tests within data
# WRITE CSV OF THE MASTER FILE
write.csv(AOVdf_total, "C:/Users/samjg/Documents/Github_repositories/Airradians_multigen_OA/RAnalysis/Output/ExcretionRates/F2/F2_ER_TDW_Statistics.csv")
#write.csv(Biodep_Master, "C:/Users/samuel.gurr/Documents/Github_repositories/Airradians_multigen_OA/RAnalysis/Output/Biodeposition/Biodeposition_master.csv")
print(F2_ER_plot)
AOVdf_total
library(ggplot2)
library(dplyr)
setwd("C:/Users/samjg/Documents/Github_repositories/Airradians_multigen_OA/RAnalysis/") # Work computer
biodep_f1 <- read.csv(file="Data/Physiology/Biodeposition/F1/cumulative_raw/Raw_masterdata_biodeposition_F1.csv", header = TRUE)
biodep_f2 <- read.csv(file="Data/Physiology/Biodeposition/F2/cumulative_raw/Raw_masterdata_biodeposition_F2.csv", header = TRUE)
biodep    <- rbind(biodep_f1, biodep_f2)
nrow(biodep) == nrow(biodep_f1) + nrow(biodep_f2) # TRUE
# (1) NAs: there is a single Na for ash filter weight - remove this
nrow(biodep) # 405 rows
nrow(biodep %>% dplyr::filter(ash_filter_weight_mg %in% NA)) #instance of an NA that IS NOT just NA for water_Input - N = 58
subset(biodep, !is.na(ash_filter_weight_mg))$ash_filter_weight_mg # now the NA is gone,use this call in the start of the pipeline below
biodep <- subset(biodep, !is.na(ash_filter_weight_mg)) # now the NA is gone,use this call in the start of the pipeline below
nrow(biodep) # 347 rows  == 405-58 GREAT!
biodep$ash_filter_weight_mg <- as.numeric(biodep$ash_filter_weight_mg)
# (2) pseudofeces below detection limit: we took notes of samples that had low to no pseudofeces - these will need to be accounted for in our rejection rate calculations
biodep %>% # use the subset biodep (with the single NA removed)
dplyr::filter(sample_type %in% 'pseudofeces') %>% # call pseudofeces samples
#dplyr::filter(sample_type %in% 'feces') %>% # call pseudofeces samples
dplyr::mutate(TPM_mg =(dry_filter_weight_mg - initial_filter_weight_mg)) %>%
dplyr::mutate(PIM_mg =(ash_filter_weight_mg - initial_filter_weight_mg)) %>%
dplyr::mutate(POM_mg =(dry_filter_weight_mg - ash_filter_weight_mg)) %>%
dplyr::arrange(TPM_mg)  # new column on the  ash weight of the pseudofeces filters
biodep2 <- biodep %>%
# Total particulate matter
dplyr::mutate(TPM_mgL = case_when(vol_filtered_L > 0 ~ ((dry_filter_weight_mg - initial_filter_weight_mg) / vol_filtered_L) ,
is.na(vol_filtered_L) ~ (dry_filter_weight_mg - initial_filter_weight_mg) )) %>%
# Particulate Inorganic matter - NOTE: mg/L for the water samples, BUT just mg for the feces and pseuodofeces (although column reads mg_L)
dplyr::mutate(PIM_mgL = case_when(vol_filtered_L > 0 ~ ((ash_filter_weight_mg - initial_filter_weight_mg) / vol_filtered_L) ,
is.na(vol_filtered_L) ~ (ash_filter_weight_mg - initial_filter_weight_mg) )) %>%
# Particulate Organic matter - NOTE: mg/L for the water samples, BUT just mg for the feces and pseuodofeces (although column reads mg_L)
dplyr::mutate(POM_mgL = case_when(vol_filtered_L > 0 ~ ((dry_filter_weight_mg - ash_filter_weight_mg) / vol_filtered_L) ,
is.na(vol_filtered_L) ~ (dry_filter_weight_mg - ash_filter_weight_mg) )) %>%
# % of Total as Particulate Inorganic matter
dplyr::mutate(Perc_INORG = ((PIM_mgL/TPM_mgL)*100) ) %>%
# % of Total as Particulate Organic matter
dplyr::mutate(Perc_ORG = ((POM_mgL/TPM_mgL)*100) ) %>%
# EGESTION RATE DATA (just for feces samples)
# Egestion rate (mg / hour)
dplyr::mutate(ER_mghr = case_when(sample_type =='feces' ~ (TPM_mgL / inclubation_time_hours)) ) %>% # although column reads mgL, feces and pseudofeces are in units of just mg
# Organic Egestion Rate (OER) POM of feces/feces collection time
dplyr::mutate(OER_mghr = case_when(sample_type =='feces' ~ (POM_mgL / inclubation_time_hours)) ) %>% # although column reads mgL, feces and pseudofeces are in units of just mg
# Inorganic Egestion Rate (OER) PIM of feces/feces collection time
dplyr::mutate(IER_mghr = case_when(sample_type =='feces' ~ (PIM_mgL / inclubation_time_hours)) ) %>% # although column reads mgL, feces and pseudofeces are in units of just mg
# REJECTION RATE DATA (just for pseudofeces samples)
# Rejection rate (mg / hour)
dplyr::mutate(RR_mghr = case_when(sample_type =='pseudofeces' ~ (TPM_mgL / inclubation_time_hours)) ) %>% # although column reads mgL, feces and pseudofeces are in units of just mg
# Organic Rejection Rate (ORR) POM of pseudofeces/pseudofeces collection time
dplyr::mutate(ORR_mghr = case_when(sample_type =='pseudofeces' ~ (POM_mgL / inclubation_time_hours)) ) %>% # although column reads mgL, feces and pseudofeces are in units of just mg
# Inorganic Rejection Rate (IRR) PIM of pseudofeces/pseudofeces collection time
dplyr::mutate(IRR_mghr = case_when(sample_type =='pseudofeces' ~ (PIM_mgL / inclubation_time_hours)) )  # although column reads mgL, feces and pseudofeces are in units of just mg
# blanks - as 'water_Blank' - call to correct in biodep2 below...
WaterSamples_blank     <- biodep2 %>%
dplyr::select(c('Date', 'sample_type', 'treatment', 'water_sample_time', 'TPM_mgL',  'PIM_mgL',  'POM_mgL', 'Perc_INORG', 'Perc_ORG')) %>%
dplyr::filter(sample_type %in% 'water_Blank') %>%
dplyr::filter(!(Date %in% '20230201' & treatment %in% 8 & water_sample_time %in% '10:25')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230201' & treatment %in% 7.5 & water_sample_time %in% '10:25')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230201' & treatment %in% 7 & water_sample_time %in% '9:20')) %>%  # abnormally low % org - omitted (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230224' & treatment %in% 8 & water_sample_time %in% c('9:50','11:10'))) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230224' & treatment %in% 7.5 & water_sample_time %in% '11:10')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::group_by(Date,treatment)
# View(WaterSamples_blank)
# slice(-1) # removes the first timestamp by group
# mean for these blanks here...
WaterSamples_blank_AVE <- WaterSamples_blank %>%
dplyr::select(-c('sample_type', 'water_sample_time')) %>% # %>%  # omit to average across all group_by columns
dplyr::group_by(Date,treatment) %>%
dplyr::mutate(TPM_mgL = as.numeric(TPM_mgL)) %>%
dplyr::summarise(across(everything(), list(mean)))
# 'water_Input' - call to correct in biodep2 below...
WaterSamples_input     <- biodep2 %>%
dplyr::select(c('Date', 'sample_type', 'treatment', 'water_sample_time', 'TPM_mgL',  'PIM_mgL',  'POM_mgL', 'Perc_INORG', 'Perc_ORG')) %>%
dplyr::filter(sample_type %in% 'water_Input') %>%
dplyr::filter(!(Date %in% '20221027' & treatment %in% 7.5 & TPM_mgL > 5)) %>%  # omit the time points 9:30 - 10:10am showing abnormally high particulate
dplyr::group_by(Date,treatment)
WaterSamples_input
WaterSamples_blank_AVE
WaterSamples_blank_AVE
WaterSamples_input
WaterSamples_input_AVE <- WaterSamples_input %>%
dplyr::select(-c('sample_type', 'water_sample_time')) %>% # %>%  # omit to average across all group_by columns
dplyr::group_by(Date,treatment) %>%
dplyr::mutate(TPM_mgL = as.numeric(TPM_mgL)) %>%
dplyr::summarise(across(everything(), list(mean)))
WaterSamples_input_AVE
WaterSamples_input
WaterSamples_blank
WaterSamples_input_AVE
WaterSamples_input
WaterSamples_blank
View(WaterSamples_blank)
# View(WaterSamples_blank)
# slice(-1) # removes the first timestamp by group
# mean for these blanks here...
WaterSamples_blank_AVE <- WaterSamples_blank %>%
dplyr::select(-c('sample_type', 'water_sample_time')) %>% # %>%  # omit to average across all group_by columns
dplyr::group_by(Date,treatment) %>%
dplyr::mutate(TPM_mgL = as.numeric(TPM_mgL)) %>%
dplyr::summarise(across(everything(), list(mean)))
WaterSamples_blank_AVE
WaterSamples_blank
WaterSamples_blank
WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time))
WaterSamples_blank
WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
pivot_longer(!c(Date,treatment), names_to = "measurement", values_to = "value")
# View(WaterSamples_blank)
WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment), names_to = "measurement", values_to = "value")
# View(WaterSamples_blank)
Blank_plotting <- WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment), names_to = "measurement", values_to = "value")
Blank_plotting
# View(WaterSamples_blank)
Blank_plotting <- WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment),
names_to = "measurement", values_to = "value") %>%
summarySEwithin(measurevar="value", withinvars=c("treatment", "Shape","measurement"), idvar="Date")
# View(WaterSamples_blank)
Blank_plotting <- WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment),
names_to = "measurement", values_to = "value") %>%
summarySEwithin(measurevar="value", withinvars=c("treatment","measurement"), idvar="Date")
Blank_plotting
# View(WaterSamples_blank)
Blank_plotting <- WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment),
names_to = "measurement", values_to = "value") %>%
summarySEwithin(measurevar="value", withinvars=c("treatment","measurement", "Date"), idvar="Subject")
Blank_plotting
# View(WaterSamples_blank)
Blank_plotting <- WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment),
names_to = "measurement", values_to = "value") %>%
summarySEwithin(measurevar="value", withinvars=c("treatment","measurement", "Date"), idvar="Date")
Blank_plotting
# View(WaterSamples_blank)
Blank_plotting <- WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment),
names_to = "measurement", values_to = "value") %>%
summarySEwithin(measurevar="value", withinvars=c("Date", "treatment","measurement"), idvar="Date")
Blank_plotting
Blank_plotting %>%
dplyr::filter(measurement %in% c(Perc_ORG, Perc_INORG)) %>%
ggplot(datac, aes(x=value/100, y=Time, fill=treatment)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=Time-ci, ymax=Time+ci)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
scale_y_continuous(breaks=seq(4:0.25)) +
theme_bw() +
geom_hline(yintercept=38) +
facet_wrapp(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(datac, aes(x=value/100, y=Time, fill=treatment))
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=value/100, y=Time, fill=treatment)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity")
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=treatment)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity")
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=treatment)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=Time-ci, ymax=Time+ci))
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=treatment)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-ci, ymax=value+ci)) +
coord_cartesian(ylim=c(0,1))
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity")
Blank_plotting
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
scale_y_continuous(breaks=seq(4:0.25)) +
theme_bw() +
geom_hline(yintercept=38) +
facet_wrapp(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
scale_y_continuous(breaks=seq(4:0.25)) +
theme_bw() +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_bw() +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_classic() +
ylab("Proportion") +
ggtitle("Biodeposition: TSM") +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_classic() +
ylab("Proportion") +
ggtitle("Biodeposition: TSM - Percent inorgnaic and organic material", size = 10) +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_classic() +
ylab("Proportion") +
ggtitle("Biodeposition: TSM - Percent inorgnaic and organic material", size = 5) +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1))
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_classic() +
ylab("Proportion") +
ggtitle("Biodeposition: TSM - Percent inorgnaic and organic material") +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Blank_plotting
Blank_plotting %>%
dplyr::filter(measurement %in% TPM_mgL) %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_line()
Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_line()
Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_errorbar(width=.1, aes(ymin=value-se, ymax=value+se)) +
geom_point(shape=21, size=3, fill="white")
Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_errorbar(width=.1, aes(ymin=value-se, ymax=value+se)) +
geom_point(shape=21, size=3, fill="white")  +
facet_wrap(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_errorbar(width=.1, aes(ymin=value-se, ymax=value+se)) +
geom_point(shape=21, size=3, fill="white")  +
theme_classic() +
facet_wrap(~Date)
WaterSamples_blank
# blanks - as 'water_Blank' - call to correct in biodep2 below...
WaterSamples_blank     <- biodep2 %>%
dplyr::select(c('Date', 'sample_type', 'treatment', 'water_sample_time', 'TPM_mgL',  'PIM_mgL',  'POM_mgL', 'Perc_INORG', 'Perc_ORG')) %>%
dplyr::filter(sample_type %in% 'water_Blank') %>%
# dplyr::filter(!(Date %in% '20230201' & treatment %in% 8 & water_sample_time %in% '10:25')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
# dplyr::filter(!(Date %in% '20230201' & treatment %in% 7.5 & water_sample_time %in% '10:25')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
# dplyr::filter(!(Date %in% '20230201' & treatment %in% 7 & water_sample_time %in% '9:20')) %>%  # abnormally low % org - omitted (noted in the worksheet!)
#
# dplyr::filter(!(Date %in% '20230224' & treatment %in% 8 & water_sample_time %in% c('9:50','11:10'))) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
# dplyr::filter(!(Date %in% '20230224' & treatment %in% 7.5 & water_sample_time %in% '11:10')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::group_by(Date,treatment)
Blank_plotting <- WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment),
names_to = "measurement", values_to = "value") %>%
summarySEwithin(measurevar="value", withinvars=c("Date", "treatment","measurement"), idvar="Date")
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_classic() +
ylab("Proportion") +
ggtitle("Biodeposition: TSM - Percent inorgnaic and organic material") +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_errorbar(width=.1, aes(ymin=value-se, ymax=value+se)) +
geom_point(shape=21, size=3, fill="white")  +
theme_classic() +
facet_wrap(~Date)
# blanks - as 'water_Blank' - call to correct in biodep2 below...
WaterSamples_blank     <- biodep2 %>%
dplyr::select(c('Date', 'sample_type', 'treatment', 'water_sample_time', 'TPM_mgL',  'PIM_mgL',  'POM_mgL', 'Perc_INORG', 'Perc_ORG')) %>%
dplyr::filter(sample_type %in% 'water_Blank') %>%
dplyr::filter(!(Date %in% '20230201' & treatment %in% 8 & water_sample_time %in% '10:25')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230201' & treatment %in% 7.5 & water_sample_time %in% '10:25')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230201' & treatment %in% 7 & water_sample_time %in% '9:20')) %>%  # abnormally low % org - omitted (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230224' & treatment %in% 8 & water_sample_time %in% c('9:50','11:10'))) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230224' & treatment %in% 7.5 & water_sample_time %in% '11:10')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::group_by(Date,treatment)
Blank_plotting <- WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment),
names_to = "measurement", values_to = "value") %>%
summarySEwithin(measurevar="value", withinvars=c("Date", "treatment","measurement"), idvar="Date")
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_classic() +
ylab("Proportion") +
ggtitle("Biodeposition: TSM - Percent inorgnaic and organic material") +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_errorbar(width=.1, aes(ymin=value-se, ymax=value+se)) +
geom_point(shape=21, size=3, fill="white")  +
theme_classic() +
facet_wrap(~Date)
WaterSamples_blank
View(WaterSamples_blank)
# blanks - as 'water_Blank' - call to correct in biodep2 below...
WaterSamples_blank     <- biodep2 %>%
dplyr::select(c('Date', 'sample_type', 'treatment', 'water_sample_time', 'TPM_mgL',  'PIM_mgL',  'POM_mgL', 'Perc_INORG', 'Perc_ORG')) %>%
dplyr::filter(sample_type %in% 'water_Blank') %>%
dplyr::filter(!(Date %in% '20230201' & treatment %in% 8 & water_sample_time %in% '10:25')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230201' & treatment %in% 7.5 & water_sample_time %in% '10:25')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230201' & treatment %in% 7 & water_sample_time %in% '9:20')) %>%  # abnormally low % org - omitted (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230224' & treatment %in% 8 & water_sample_time %in% c('9:50','11:10'))) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230224' & treatment %in% 7.5 & water_sample_time %in% '11:10')) %>%  # omit sample with obvious filter errors (noted in the worksheet!)
dplyr::filter(!(Date %in% '20230201' & treatment %in% 8 & water_sample_time %in% '9:45')) %>%  # omit sample with obvious error
dplyr::group_by(Date,treatment)
Blank_plotting <- WaterSamples_blank %>% dplyr::select(!c(sample_type, water_sample_time)) %>%
tidyr::pivot_longer(!c(Date,treatment),
names_to = "measurement", values_to = "value") %>%
summarySEwithin(measurevar="value", withinvars=c("Date", "treatment","measurement"), idvar="Date")
Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_classic() +
ylab("Proportion") +
ggtitle("Biodeposition: TSM - Percent inorgnaic and organic material") +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_errorbar(width=.1, aes(ymin=value-se, ymax=value+se)) +
geom_point(shape=21, size=3, fill="white")  +
theme_classic() +
facet_wrap(~Date)
# slice(-1) # removes the first timestamp by group
# mean for these blanks here...
WaterSamples_blank_AVE <- WaterSamples_blank %>%
dplyr::select(-c('sample_type', 'water_sample_time')) %>% # %>%  # omit to average across all group_by columns
dplyr::group_by(Date,treatment) %>%
dplyr::mutate(TPM_mgL = as.numeric(TPM_mgL)) %>%
dplyr::summarise(across(everything(), list(mean)))
# 'water_Input' - call to correct in biodep2 below...
WaterSamples_input     <- biodep2 %>%
dplyr::select(c('Date', 'sample_type', 'treatment', 'water_sample_time', 'TPM_mgL',  'PIM_mgL',  'POM_mgL', 'Perc_INORG', 'Perc_ORG')) %>%
dplyr::filter(sample_type %in% 'water_Input') %>%
dplyr::filter(!(Date %in% '20221027' & treatment %in% 7.5 & TPM_mgL > 5)) %>%  # omit the time points 9:30 - 10:10am showing abnormally high particulate
dplyr::group_by(Date,treatment)
WaterSamples_input_AVE <- WaterSamples_input %>%
dplyr::select(-c('sample_type', 'water_sample_time')) %>% # %>%  # omit to average across all group_by columns
dplyr::group_by(Date,treatment) %>%
dplyr::mutate(TPM_mgL = as.numeric(TPM_mgL)) %>%
dplyr::summarise(across(everything(), list(mean)))
water_samples_master <- rbind( (as.data.frame(WaterSamples_input_AVE %>% dplyr::mutate(Type = 'input'))),
(as.data.frame(WaterSamples_blank_AVE %>% dplyr::mutate(Type = 'blank'))) )
Total_TSM <-Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_errorbar(width=.1, aes(ymin=value-se, ymax=value+se)) +
geom_point(shape=21, size=3, fill="white")  +
theme_classic() +
facet_wrap(~Date)
Perc_TSM <- Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_classic() +
ylab("Proportion") +
ggtitle("Biodeposition: TSM - Percent inorgnaic and organic material") +
geom_hline(yintercept=38) +
facet_wrap(~Date)
ggarrange(Perc_TSM, Total_TSM)
ggarrange(Perc_TSM, Total_TSM, nrow=2)
Total_TSM <-Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_errorbar(width=.1, aes(ymin=value-se, ymax=value+se)) +
geom_point(shape=21, size=3, fill="white")  +
theme_classic() +
ylab("TPM_mgL") +
ggtitle("Biodeposition: Total particulate material") +
facet_wrap(~Date)
ggarrange(Perc_TSM, Total_TSM, nrow=2)
Perc_TSM <- Blank_plotting %>%
dplyr::filter(measurement %in% c('Perc_ORG', 'Perc_INORG')) %>%
ggplot(aes(x=treatment, y=value/100, fill=measurement)) +
geom_bar(position=position_dodge(.9), colour="black", stat="identity") +
geom_errorbar(position=position_dodge(.9), width=.25, aes(ymin=value-se, ymax=value+se)) +
coord_cartesian(ylim=c(0,1)) +
scale_fill_manual(values=c("#CCCCCC","#FFFFFF")) +
# scale_y_continuous(breaks=seq(4:0.25)) +
theme_classic() +
ylab("Proportion") +
ggtitle("Biodeposition: TSM - Percent inorgnaic and organic material") +
geom_hline(yintercept=38) +
facet_wrap(~Date)
Total_TSM <-Blank_plotting %>%
dplyr::filter(measurement %in% 'TPM_mgL') %>%
ggplot(aes(x=treatment, y=value, group=1)) +
geom_errorbar(width=.1, aes(ymin=value-se, ymax=value+se)) +
geom_point(shape=21, size=3, fill="white")  +
theme_classic() +
ylab("TPM_mgL") +
ggtitle("Biodeposition: Total particulate material") +
facet_wrap(~Date)
ggarrange(Perc_TSM, Total_TSM, nrow=2)
